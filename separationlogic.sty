%% Types
% Logical variable
\newcommand{\V}[1]{{\ensuremath{\mathrm{#1}}}}
% Logical expression
\newcommand{\E}[1]{{\ensuremath{\mathit{#1}}}}
% ?
\newcommand{\T}[1]{\textsc{#1}}

%% Sorts
\newcommand{\sortstyle}[1]{\ensuremath{\mathcal{#1}}}
% Locations
\newcommand{\loc}{\sortstyle{L}}
% Variables
\newcommand{\vars}{\sortstyle{X}}
% User variables
\newcommand{\uvars}{\vars^{\T u}}
% Internal variables
\newcommand{\ivars}{\vars^{\T i}}

%% Operational Semantics
\newcommand{\evalsto}{{\,\longrightarrow\,}}
% Dereferencing evals-to
\newcommand{\gevalsto}{\overset{\gamma}{\evalsto}}

%% Auxiliaries
% General (dual-defined)
\newcommand{\ReadWrite}{\command{RW}}
\newcommand{\RW}{\ReadWrite}
\newcommand{\ReadOnly}{\command{RO}}
\newcommand{\RO}{\ReadOnly}
\newcommand\istrue{\command{True}}
\newcommand\isfalse{\command{False}}
\newcommand\objOrGlob{\command{SelectProto}}
\newcommand\getBase{\command{getBase}}
\newcommand\parse{\command{parse}}
\newcommand\fun{\command{fun}}
\newcommand\act{\command{act}}
\newcommand\defs{\command{defs}}
\newcommand\pickThis{\command{This}}
% Operational Semantics only
\newcommand\obj{\command{obj}}
\newcommand\auxDef{\command{auxDef}}
\newcommand\auxDefGet{\command{auxDefGet}}
\newcommand\auxDefSet{\command{auxDefSet}}
% Program logic only
\newcommand{\newobj}{\command{newobj}}
\newcommand{\fullobj}{\command{fullobj}}
\newcommand{\newfun}{\command{newfun}}
\newcommand{\vardecls}{\command{decls}}
\newcommand{\scopePtrs}{\command{scopePtrs}}

%% erm...
\newcommand{\logconst}[1]{\V{#1}}
\newcommand{\fault}{{\command{fault}}}
\newcommand{\false}{\texttt{false}}
\newcommand{\true}{\texttt{true}}
\newcommand{\emp}{\texttt{emp}}
\newcommand{\emptylist}{[\,]}
\newcommand\emptystr{\text{``\,"}}

\newcommand{\lemp}\oslash%{\E{emp}}
\newcommand{\none}{\diameter}
\newcommand{\rv}{\V{\textbf{r}}}
\newcommand{\gv}{\V{\textbf{g}}}
\newcommand{\ls}{\textbf{l}}
\newcommand{\dotin}{\mathbin{\dot\in}}
\newcommand{\notdotin}{\mathbin{\not\!\!\dot{\in}}}

\newcommand{\scope}{\ensuremath{\sigma}\xspace}
\newcommand{\proto}{\ensuremath{\pi}\xspace}
\newcommand{\getValue}{\ensuremath{\gamma}\xspace}
\newcommand{\bpGen}{\ensuremath{\beta}\xspace}

\newcommand\lgo{l_g}
\newcommand\lop{l_{op}}
\newcommand\lfp{l_{fp}}

\newcommand{\command}[1]{\ensuremath{\mathsf{#1}}\xspace}
\newcommand{\dom}{\command{dom}}
\newcommand{\fv}{\command{fv}}
\newcommand{\elem}{\command{elem}}
\newcommand{\env}{\epsilon}%{\command{env}}
\newcommand{\und}{\js{undefined}}
\newcommand{\nil}{\js{null}\xspace}
\newcommand{\js}[1]{\ensuremath{\mathtt{#1}}}
\newcommand{\jsfun}[3][]{\js{function\ #1(#2)\{#3\}}}
\newcommand{\jsnew}[2]{\js{new\ #1(#2)}}
\newcommand{\jsvar}[1]{\js{var\ #1}}
% What is this for?
\newcommand{\njs}[1]{#1}

%%%%%%%%%%%%%
% OPERATORS %
%%%%%%%%%%%%%
\newcommand{\pipe}{\mathrel{|}}
\newcommand{\sep}{\mathbin{*}}
\newcommand{\sepish}{\mathbin{\sqcup\mkern-10mu*}}
\newcommand{\wand}{\mathbin{-\mkern-6mu *}}
\newcommand{\bigsep}{\circledast}
\newcommand{\bigsepish}{\mathop{\bigsqcup\mkern-15mu*\mkern3mu}}

% Hypothetical heap update
\newcommand{\upd}{\mathbin{!}}
% Hypothetical wand
\newcommand{\boxwand}{\mathbin{-\mkern-3mu \boxast}}

\newcommand{\disj}{\mathbin{\#}}
\newcommand{\disju}{\uplus}
\newcommand{\impl}{\Rightarrow}
\newcommand{\satisfies}{\models}
\newcommand{\takes}{\shortleftarrow}
\newcommand{\pointsto}{\mapsto}
\newcommand{\bp}{\leftarrow}
\newcommand{\cons}{{:}}
\newcommand{\length}{\text{length}\xspace}
\newcommand{\lstitem}{\text{item}\xspace}
\newcommand{\fld}[2]{#1\makebox[3pt]{$\cdot$}{#2}}
\newcommand{\st}{\mathpunct{.}}

\newcommand{\eval}[1]{\llbracket #1 \rrbracket}
\newcommand{\evalle}[1]{\eval{#1}^L_\env}

% Hoare triple {P}{C}{Q}
\newcommand\tr[3]{\{#1\}#2\{#3\}}

% Proofs
\newcommand{\logic}[1]{%
  \left\{%
    \begin{array}{l}%
      #1%
    \end{array}%
  \right\}}
\newcommand{\step}[1]{\text{[#1]}}

%%%%%%%%%%%%%%
% Formatting %
%%%%%%%%%%%%%%
\newcommand{\vg}{\\[5pt]}
\newcommand{\rsep}{\qquad}

% --------------------------------------------------------------------- %
% Proof rule.                                                           %
% --------------------------------------------------------------------- %
%\makeatletter
%\newcommand{\addToLabel}[1]{%
%  \protected@edef\@currentlabel{\@currentlabel#1}%
%}
%\makeatother
%\newcounter{rule}
%\renewcommand{\therule}{}

% Axiom {(tag)}{def}{?}
\newcommand{\stateaxiom}[3][]{%
%  \refstepcounter{rule}%
%  \addToLabel{#2}%
  $\begin{array}[b]{@{}l}%
    \mbox{#2#1}\\%
    \begin{array}{c}
      #3
    \end{array}
  \end{array}$}

% Inference rule {(tag)}{top}{bottom}{sidecondition}
\newcommand{\staterule}[4][]{%
%  \refstepcounter{rule}%
%  \addToLabel{#2}%
  $\begin{array}[b]{@{}l}%
    \mbox{#2#1}\\%
    \begin{array}{l}
      #3\\
      \hline
      \raisebox{0ex}[2.5ex]{\strut}#4%
    \end{array}
  \end{array}$}

% Definitions of opsem predicates
\newcommand{\jaxiom}[2]{$#1{\;\triangleq\;}#2$}

\newcommand{\jrule}[3]{%
  $\begin{array}[b]{@{}l}%
    \begin{array}{l}
      #3\\
      \hline
      \raisebox{0ex}[2.5ex]{\strut}#1{\;\triangleq\;}#2%
    \end{array}
  \end{array}$}

% Display environment preqs
\let\smallish\small

\newcommand{\hbra}{
  %\hbox to \textwidth{\vrule width0.3mm height 1.8mm depth-0.3mm
  \hbox to \linewidth{\vrule width0.3mm height 1.8mm depth-0.3mm
    \leaders\hrule height1.8mm depth-1.5mm\hfill
    \vrule width0.3mm height 1.8mm depth-0.3mm}}
\newcommand{\hket}{
  %\hbox to \textwidth{\vrule width0.3mm height1.5mm
  \hbox to \linewidth{\vrule width0.3mm height1.5mm
    \leaders\hrule height0.3mm\hfill
    \vrule width0.3mm height1.5mm}}

\newcommand{\ratio}{.375}

% TODO: Find a way to swap out the tabbing env - it's annoying/misused
\newenvironment{display}[1]{\vspace{-0.5ex}\smallish
\begin{tabbing}
    \hspace{1.5em} \= \hspace{\ratio\linewidth-1.5em} \= \hspace{1.5em} \= \kill
    \textbf{#1}\\[-.2ex] % was -.8
    \hbra\\[-.8ex]
  }{\\[-.8ex]\hket
  \end{tabbing}\vspace{-1ex}}

% Command to wrap in tabbing/display environment
% http://newsgroups.derkeiler.com/Archive/Comp/comp.text.tex/2006-02/msg00282.html
\makeatletter
\newcommand\tabfill[1]{%
\dimen@\linewidth%
\advance\dimen@\@totalleftmargin%
\advance\dimen@-\dimen\@curtab%
%\parbox[t]\dimen@{#1\ifhmode\strut\fi}%
\parbox[t]\dimen@{\raggedright #1\ifhmode\strut\fi}%
}
\makeatother
